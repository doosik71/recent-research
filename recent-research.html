<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recent Research</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .pdf-button {
      font-size: smaller;
      color: white;
      background-color: firebrick;
      padding: 0.05em 0.25em;
      border-radius: 0.2em;
    }

    .pdf-button:hover {
      color: yellow;
      background-color: crimson;
      text-decoration: none;
    }

    .translate-button {
      font-size: smaller;
      color: white;
      background-color: dodgerblue;
      border: none;
      padding: 0em 0.25em;
      border-radius: 0.2em;
    }

    hr {
      width: 50%;
      margin: 0.5em auto;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 class="my-3">Recent Research</h1>
    <div class="input-group">
      <label class="input-group-text c-1" for="research-topic">Topic</label>
      <input type="text" id="research-topic" placeholder="Topic to search..." class="col-10" />
      <button class="btn btn-outline-secondary" type="button" onclick="getArxivList()">Search</button>
    </div>
    <div class="input-group mb-5">
      <label class="input-group-text invisible">Topic</label>
      <select title="Choose topic" class="form-select col-10" onchange="setInputValue('research-topic', this.value);">
        <option selected>Choose topic...</option>
      </select>
    </div>
    <hr/>
    <div id="arxiv-list"></div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    function addTopicOptionsFromFile(file) {
      fetch(file)
        .then(response => response.text())
        .then(text => {
          const topics = text.split('\n');
          const select = document.querySelector('select');
          topics.forEach(topic => {
            if (topic === '') return;
            const option = document.createElement('option');
            option.textContent = topic;
            select.appendChild(option);
          });
        });
    }

    addTopicOptionsFromFile('topics.txt');

    function setInputValue(id, value) {
      document.getElementById(id).value = value;
    }

    function translateSummary(button) {
      const summary = button.parentElement.previousElementSibling.textContent;
      const summaryEscaped = encodeURIComponent(summary);
      const url = `https://www.bing.com/translator?text=${summaryEscaped}&from=en&to=ko`;
      window
        .open(url, '_blank')
        .focus();
    }

    async function getArxivList() {
      const arxivList = document.getElementById('arxiv-list');
      arxivList.innerHTML = 'Searching...';

      const researchTopic = document.getElementById('research-topic').value;
      const url = `https://export.arxiv.org/api/query?search_query=all:${researchTopic}&start=0&max_results=100&sortBy=relevance&sortOrder=descending`;
      const response = await fetch(url);
      const data = await response.text();
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(data, "text/xml");
      const entries = xmlDoc.getElementsByTagName('entry');
      arxivList.innerHTML = '';

      const entriesArray = Array.from(entries);
      entriesArray.sort((a, b) => {
        const dateA = a.getElementsByTagName('published')[0].textContent;
        const dateB = b.getElementsByTagName('published')[0].textContent;
        return dateB.localeCompare(dateA);
      });

      for (let i = 0; i < entriesArray.length; i++) {
        const title = entriesArray[i].getElementsByTagName('title')[0].textContent;
        const authorNodeList = entriesArray[i].getElementsByTagName('author');
        const date = entriesArray[i].getElementsByTagName('published')[0].textContent.split('T')[0].replace(/-/g, '.');
        const summary = entriesArray[i].getElementsByTagName('summary')[0].textContent;

        const link = entriesArray[i].getElementsByTagName('id')[0].textContent;
        const authors = Array.from(authorNodeList).map(a => a.getElementsByTagName('name')[0].textContent).join(', ');
        const pdf = link.replace('/abs/', '/pdf/');

        arxivList.innerHTML += `<div>
                                  <h3 class="mt-3"><a href="${link}" target="_blank">${title}</a></h3>
                                  <p><i>${authors}</i> (${date})</p>
                                  <p id="summary" class="mb-1">${summary}</p>
                                  <div class="mt-1">
                                    <a href="${pdf}" target="_blank" class="pdf-button">PDF</a>
                                    <button class="translate-button" type="button" onclick="translateSummary(this);">í•œ</button>
                                  </div>
                                  <hr/>
                                </div>`;
      }
    }
  </script>

</body>

</html>